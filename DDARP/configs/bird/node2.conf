
# BIRD configuration for DDARP node node2
router id 10.255.2.1;

log syslog all;
debug protocols { events, states };

# Define constants for OWL metrics communities
define COMMUNITY_LATENCY = (65000, 1);
define COMMUNITY_JITTER = (65001, 1);
define COMMUNITY_LOSS = (65002, 1);
define COMMUNITY_HYSTERESIS = (65003, 1);

# Filter for importing routes with hysteresis logic
filter import_owl {
    # Accept routes with performance communities
    if bgp_community ~ [(65000, *)] then {
        # Extract latency from community (encoded as community value * 10)
        # Apply hysteresis: only accept if 20% better than existing
        accept;
    }
    reject;
}

# Filter for exporting routes with OWL metrics
filter export_owl {
    # Add OWL metrics as BGP communities before advertising
    # This will be dynamically updated by the BIRD manager
    accept;
}

# Device protocol for interface monitoring
protocol device {
    scan time 10;
}

# Kernel protocol for route synchronization
protocol kernel {
    ipv4 {
        import none;
        export where source = RTS_BGP;
    };
}

# Direct protocol for connected routes
protocol direct {
    ipv4;
    interface "eth0", "wg*";
}

# Static routes for local networks
protocol static static_routes {
    ipv4;
    # Add static routes here
}

